((function(){window.HS_INLINE_STYLE={supportedStyles:["color","background-color","border-color","border-style","border-width","border-radius","padding-top","padding-right","padding-bottom","padding-left","margin-top","margin-right","margin-bottom","margin-left","text-align","font-family","font-size","line-height","font-weight","font-variant","opacity"]}})).call(this),function(a){"$:nomunge";var b,c,d=1,e,f=this,g=!1,h="postMessage",i="addEventListener",j,k=typeof f[h]=="function";a[h]=function(b,c,e){if(!c)return;b=typeof b=="string"?b:a.param(b),e=e||parent,k?e[h](b,c.replace(/([^:]+:\/\/[^\/]+).*/,"$1")):c&&(e.location=c.replace(/#.*$/,"")+"#"+ +(new Date)+d++ +"&"+b)},a.receiveMessage=j=function(d,h,l){k?(d&&(e&&j(),e=function(b){if(typeof h=="string"&&b.origin!==h||a.isFunction(h)&&h(b.origin)===g)return g;d(b)}),f[i]?f[d?i:"removeEventListener"]("message",e,g):f[d?"attachEvent":"detachEvent"]("onmessage",e)):(b&&clearInterval(b),b=null,d&&(l=typeof h=="number"?h:typeof l=="number"?l:100,b=setInterval(function(){var a=document.location.hash,b=/^#?\d+&/;a!==c&&b.test(a)&&(c=a,d({data:a.replace(b,"")}))},l)))}}(typeof window.hsjQuery!="undefined"?window.hsjQuery:window.jQuery),function(){var a;a=window.hsjQuery!=null?window.hsjQuery:window.jQuery,window.HSCrossdomainMessanger=function(){function b(b,c,d){this.remoteDomain=b,this.window=c,this.debug=d!=null?d:!1,a.receiveMessage(a.proxy(this.onMessage,this))}return b.prototype.idIncrement=0,b.prototype.callbacks={},b.prototype.postMessage=function(b,c){var d;return a.isFunction(c)?(b._callbackId=this.idIncrement,b._start=+(new Date),this.idIncrement++,this.callbacks[b._callbackId]=c):b._callbackId&&b.response&&(b.response._start=b._start,b.response._end=+(new Date)),d=JSON.stringify(b),this.log("Posting message to "+this.remoteDomain),this.log(b),a.postMessage(d,this.remoteDomain,this.window)},b.prototype.onMessage=function(b){var c,d;d=!1;try{c=JSON.parse(b.data),a.isPlainObject(c)&&(d=!0)}catch(e){b=e,c=b.data}if(!d){this.log("Invalid message recived"),this.log(c);return}return this.debug&&(this.log("Recevied message from "+b.origin),this.log(c)),a.isPlainObject(c)&&c._callbackId!=null&&this.callbacks[c._callbackId]?this.callbacks[c._callbackId](c.response):a(this).trigger("message",c)},b.prototype.log=function(a){if(this.debug&&window.console!=null&&window.console.log!=null)return console.log(a)},b}()}.call(this),function(){var a,b,c,d,e,f,g,h=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};a=window.hsjQuery!=null?window.hsjQuery:window.jQuery,f={edit:"pictos-1-png/32/pictos-set1-136.png",move:"pictos-1-png/32/pictos-set1-1.png",remove:"pictos-1-png/32/pictos-set1-199.png",style:"pictos-2-png/32/pictos-set2-26.png"},g=function(a){return"//static.hsappstatic.net/pictos_images/static-1.6/img/"+a},d='<li><a class="edit hs-pill-button" title="Edit module options"><img src="'+g(f.edit)+'" /></a></li>\n<li><a class="move hs-pill-button container-only" title="Move module"><img src="'+g(f.move)+'" /></a></li>\n<li><a class="remove hs-pill-button container-only" title="Remove module"><img src="'+g(f.remove)+'" /></a></li>\n<li style="display: none"><a class="style hs-pill-button" title="Style module"><img src="'+g(f.style)+'" /></a></li>',e='<div id="full-screen-edit-page-iframe-module-menu">\n    <ul class="hs-pill-buttons">\n       '+d+"\n    </ul>\n</div>",b='<div id="full-screen-edit-page-iframe-context-menu" class="hs-popover-item"></div>',c=function(){function c(c,d){this.remoteDomain=c,this.remoteWindow=d,this.messenger=new HSCrossdomainMessanger(this.remoteDomain,this.remoteWindow),a(this.messenger).on("message",a.proxy(this.onMessage,this)),this.$menu=a(b),this.$module_menu=a(e),this.$module_menu.find("a.style").click(a.proxy(this.styleWidget,this,{})),a("body").addClass("inpage-editing").append(this.$menu).append(this.$module_menu),this.disableBodyClicks()}return c.prototype.targetsShown=!1,c.prototype.activeTabName="content",c.prototype.active_widget_key="",c.prototype.active_container_name="",c.prototype.zoomFactor=1,c.prototype.scrollTop=0,c.prototype.inlineStyleEnabled=!1,c.prototype.onMessage=function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o;switch(c.action){case"zoom":return this.zoom(c);case"setScrollTop":return this.scrollTop=c.scrollTop;case"setContentSchema":return this.onSetContentSchema(c);case"showAddModuleTargets":return this.show_add_module_targets(c.widget_data,c.container_name);case"cancelTarget":return this.cancel_target();case"removeModuleFromDom":return a("#hs_cos_wrapper_widget_"+c.id).remove();case"updateWidget":return k=a(c.selector).length>0,(n=c.fieldType)==="image"||n==="linked_image"||n==="logo"?this.updateImageWidget(c):a.type(c.fieldData)==="string"&&a(c.selector).html(c.fieldData),h={id:c.id,widgetFound:k},c.fieldData=null,this.postMessage(a.extend(c,{response:h}));case"updateHtml":return a(c.selector).html(c.html);case"setDisplayMode":return this.displayMode=c.mode;case"setWidgetStyle":return a("#hs_cos_wrapper_"+c.id).attr("style","").css(c.css);case"setEdtiorCss":return d=a('<style id="hs_editor_style" type="text/css" />').text(c.cssStr),a("#hs_editor_style").length?a("#hs_editor_style").replaceWith(d):a("body").append(d);case"getBodySize":return a.extend(c,{response:this.getBodySize()}),this.postMessage(c);case"getComputedStyle":e=a("#hs_cos_wrapper_"+c.id);if(e.length){j=e.hasClass("hs_cos_wrapper_widget_hovered"),j&&e.removeClass("hs_cos_wrapper_widget_hovered"),i=window.getComputedStyle(e.get(0)),f={},o=window.HS_INLINE_STYLE.supportedStyles;for(l=0,m=o.length;l<m;l++)g=o[l],f[g]=i[g];this.postMessage(a.extend(c,{response:f}));if(j)return e.addClass("hs_cos_wrapper_widget_hovered")}break;case"enableInlineStyle":return this.inlineStyleEnabled=!0,this.$module_menu.find("a.style").parent().show();case"updateActiveTab":return this.activeTabName=c.tabName;case"hideMenus":return this.hide_preview_menus()}},c.prototype.postMessage=function(a){return this.messenger.postMessage(a)},c.prototype.disableBodyClicks=function(){var b,c,d,e=this;return d="hs_cos_wrapper",b="hs_cos_wrapper_widget_container",c=["hs-test-link","hs_cos_widget_drop_target"],a("body").click(function(f){var g,h,i,j,k,l;if(a(f.target).parents("#"+e.$menu.attr("id")).length)return!0;for(k=0,l=c.length;k<l;k++){i=c[k];if(a(f.target).hasClass(i))return!0}return f.preventDefault(),f.stopPropagation(),h=a(f.target),g=h.parents("."+d+(":not(."+b+")")),g.length&&(h=g),h.hasClass(d)&&(j=h.attr("id").substr(d.length+1),e.activeTabName==="style"?e.styleWidget({ifStyleTabSelected:!0}):e.postMessage({action:"scrollToField",id:j}),e.render_context_menu(f,h,j)),!1}),a(window).scroll(function(){return e.hide_preview_menus}),a("body").mousemove(function(b){var c,d,f;if(e.targetsShown)return;c=a(b.target),f="#full-screen-edit-page-iframe-module-menu, #full-screen-edit-page-iframe-context-menu";if(c.is(f)||c.parents(f).length)return;return c.hasClass("hs_cos_wrapper_widget")||c.hasClass("hs_cos_wrapper_meta_field")?d=c:c.parents(".hs_cos_wrapper_widget, .hs_cos_wrapper_meta_field").length&&(d=c.parents(".hs_cos_wrapper_widget, .hs_cos_wrapper_meta_field").first()),d?e.show_menu(d,c,b):e.hide_preview_menus()})},c.prototype.getBodySize=function(){return{width:a("html").outerWidth(),height:a("html").outerHeight()}},c.prototype.zoom=function(b){var c;return c=1,b.fit==="scaleTo"&&(c=b.scaleTo),this.zoomFactor=c,a("html").scaleTo(c).css({overflow:"hidden"}),this.zoomFactor===1&&a(window).width()===320?(this.$menu.addClass("mobile"),a("html").addClass("hs-preview-mobile")):(this.$menu.removeClass("mobile"),a("html").removeClass("hs-preview-mobile"))},c.prototype.updateImageWidget=function(b){a(b.selector).find("img").width(b.fieldData.width).height(b.fieldData.height);if(b.fieldData.src!==a(b.selector).attr("src"))return a(b.selector).find("img").attr("src",b.fieldData.src)},c.prototype.onSetContentSchema=function(b){var c,d;return this.contentSchema=b.schema,d=["menu"],c=function(b){if(h.call(d,b)<0)return a("#hs_cos_wrapper_"+b).attr("data-overrideable","true")},a.each(this.contentSchema.widgets,function(a,b){var e;if(e=b.type,h.call(d,e)<0)return c(a)}),a.each(this.contentSchema.widget_containers,function(b,e){return a.each(e.widgets,function(a,b){var e;if(e=!b.type,h.call(d,e)>=0)return c(b.name)})}),c("email_body")},c.prototype.styleWidget=function(b){var c;return b==null&&(b={}),c=a.extend({action:"styleWidget",id:this.active_widget_key},b),this.postMessage(c)},c.prototype.show_menu=function(a,b,c){var d;this.active_widget_key=a.attr("id").replace("hs_cos_wrapper_",""),d=a.parents(".hs_cos_wrapper_widget_container");if(!a.data("overrideable")&&!d.length)return;return d.length?(this.active_container_name=a.parents(".hs_cos_wrapper_widget_container").attr("id").replace("hs_cos_wrapper_",""),this.render_module_menu(c,a,!0)):this.render_module_menu(c,a,!1)},c.prototype.render_module_menu=function(b,c,d){var e,f,g,h,i;return d==null&&(d=!0),h=45,e=25,this.$module_menu.css({opacity:0}).scaleTo(1/this.zoomFactor).show().find("a.edit").unbind("click").click(a.proxy(this.click_edit_module,this)).end().unbind("mouseover").mouseover(function(){return c.addClass("hs_cos_wrapper_widget_hovered")}).unbind("mouseout").mouseout(function(){return c.removeClass("hs_cos_wrapper_widget_hovered")}),d?this.$module_menu.find("a.container-only").show().end().find("a.move").click(a.proxy(this.click_move_module,this)).end().find("a.swap").click(a.proxy(this.click_swap_module,this)).end().find("a.remove").click(a.proxy(this.click_remove_module,this)).end():this.$module_menu.find("a.container-only").hide(),this.$module_menu.find("a").removeClass("first last"),this.$module_menu.find("a").not(":hidden").first().addClass("first"),this.$module_menu.find("a").not(":hidden").last().addClass("last"),i=(c.offset().top-h)*(1/this.zoomFactor),f="",this.scrollTop+h>Math.abs(i)-e&&(i=this.scrollTop*(1/this.zoomFactor)+e,f="detached"),g=c.offset().left*(1/this.zoomFactor),this.$module_menu.css({height:h,top:i,left:g,opacity:1}).removeClass("detached").addClass(f)},c.prototype.click_edit_module=function(){return this.postMessage({action:"scrollToField",id:this.active_widget_key})},c.prototype.click_move_module=function(){return this.show_targets("Click to move here","Cancel move",this.active_widget_key,this.active_container_name,a.proxy(this.do_move_module,this))},c.prototype.show_add_module_targets=function(a,b){var c,d=this;return c=function(b,c,e,f){return d.postMessage({action:"addModule",widget:a,target_position:f,target_container_name:e})},this.show_targets("Add module here","Cancel add",null,b,c)},c.prototype.hide_preview_menus=function(){return this.$menu.hide(),this.$module_menu.hide()},c.prototype.show_targets=function(b,c,d,e,f){var g,h,i;return this.cancel_target(),this.targetsShown=!0,this.hide_preview_menus(),i=function(c){return a('<div class="hs_cos_widget_drop_target">\n    '+b+"\n</div>")},h=function(b){return b.click(function(){var c,g,h,i;return b=a(this),c=a(this).parents(".hs_cos_wrapper_widget_container"),h=c.attr("id").replace("hs_cos_wrapper_",""),i=0,g=!1,c.find("> div").each(function(c){a(this).hasClass("hs_cos_wrapper_widget")&&!a(this).hasClass("hs_cos_widget_to_be_moved")&&!g&&i++;if(a(this).hasClass("hs_cos_widget_drop_target")&&a(this).is(b))return g=!0}),f(d,e,h,i)})},g=a("#hs_cos_wrapper_"+d),g.addClass("hs_cos_widget_to_be_moved").hide(),g.after(a('<div class="hs_cos_widget_drop_target_cancel">Cancel move</div>').click(a.proxy(this.cancel_target,this))),a(".hs_cos_wrapper_widget_container").each(function(){var b,c;return c=0,a(this).find("#hs_cos_wrapper_"+d+":first-child").length||(b=i(c),a(this).prepend(b),h(b)),a(this).find(".hs_cos_wrapper_widget").each(function(){var e,f;c++,e=a(this).next(".hs_cos_wrapper_widget"),f="hs_cos_wrapper_"+d;if(a(this).attr("id")===f||e.length&&e.attr("id")===f)return;return b=i(c),a(this).after(b),h(b)})})},c.prototype.do_move_module=function(a,b,c,d){return this.cancel_target(),this.postMessage({action:"moveModule",widget_key:a,target_container_name:c,old_container_name:b,target_position:d})},c.prototype.cancel_target=function(){a(".hs_cos_widget_to_be_moved").show(),a(".hs_cos_widget_drop_target_cancel").remove(),a(".hs_cos_widget_drop_target").remove(),this.targetsShown=!1},c.prototype.click_remove_module=function(){return this.postMessage({action:"removeModule",container_name:this.active_container_name,id:this.active_widget_key.replace("widget_","")})},c.prototype.render_context_menu=function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o=this;g="",f="",l=this.contentSchema.widgets[d]||{},j=l.type!=null,j||(l.type=l.type||"text"),e=a(b.target),h=e.get(0).nodeName.toLowerCase(),h==="a"?f=e.attr("href")||"#":e.parents("a").length&&(f=e.parents("a").attr("href")||"#");if(f!=="")if(f==="#")g="<span>Link missing</span>";else if(l.type==="text"||l.type==="rich_text")g='<span>\n    <b>Test link:</b> <a class="hs-test-link" href="'+f+'" target="_blank">'+f+"</a>\n</span>";else if(l.type==="image"||l.type==="linked_image"||l.type==="logo")k=c.find("img").attr("src"),g='<span>\n    <b>Test link:</b> <a href="'+f+'" target="_blank">'+f+"</a>\n</span>",k!==""&&(g+='<span>\n    <b>View image:</b> <a href="'+k+'" target="_blank">'+k+"</a>\n</span>");g!==""?(g='<div class="inner">\n    <div class="content">\n        '+g+'\n        <a class="close">&times;</a>\n    </div>\n</div>',this.$menu.html(g).show(),this.$menu.find(".close").unbind("click").click(function(){return o.$menu.hide()})):this.$menu.hide(),m=a(window).height(),n=a(window).width(),i=-50,this.$menu.css({top:Math.min(m-this.$menu.outerHeight(),e.offset().top+e.outerHeight())+i,left:Math.min(n-this.$menu.outerWidth(),e.offset().left)}).scaleTo(1/this.zoomFactor);if(a("html").hasClass("hs-preview-mobile"))return this.$menu.css({left:5})},c}(),a.fn.scaleTo=function(b){var c;return c="0px 0px",a(this).css({"transform-origin":c,transform:"scale("+b+")","-webkit-transform-origin":c,"-webkit-transform":"scale("+b+")","-moz-transform-origin":c,"-moz-transform":"scale("+b+")","-ms-transform-origin":c,"-ms-transform":"scale("+b+")"})},a(document).ready(function(){return window.self===window.top?console.log("Not framed, cannot init in page editing."):window.page_editor=new c(hsVars.app_hs_base_url,window.parent)})}.call(this);